
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="referrer" content="no-referrer" />
  <title>PYMCC</title>

<!-- Font Awesome -->
<link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
<!-- Theme style -->
<link rel="stylesheet" href="css/adminlte.min.css">
<link rel="stylesheet" href="css/style.css">
<!-- daterange picker -->
<link rel="stylesheet" href="plugins/daterangepicker/daterangepicker.css">

<!-- Tempusdominus Bootstrap 4 (may be used for date and time picker) -->
<link rel="stylesheet" href="plugins/tempusdominus-bootstrap-4/tempusdominus-bootstrap-4.min.css">

<!--For Alert Notification Popup-->
<link rel="stylesheet" href="plugins/toastr/toastr.min.css">

<style>
	#main-sidebar { background-color: #E1483A; }
</style>

<!-- jQuery -->
<script src="js/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="js/adminlte.min.js"></script>

<!-- date-range-picker -->
<script src="plugins/moment/moment_updated.js"></script>
<script src="plugins/daterangepicker/daterangepicker.js"></script>
<!-- Tempusdominus Bootstrap 4 used for date and time picker also-->
<script src="plugins/tempusdominus-bootstrap-4/tempusdominus-bootstrap-4.min.js"></script>

<!--For Alert Notification Popup-->
<script src="plugins/toastr/toastr.min.js"></script>
<!-- Common Input Validation -->
<script src="js/commonValidation.js"></script>


</head>
<body class="hold-transition sidebar-mini sidebar-collapse" style="font-size:12px;">
<!-- Site wrapper -->
<div class="wrapper">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="#" class="nav-link">Home</a>      </li>      
    </ul>

    <!-- Right navbar links -->
	
    <ul class="navbar-nav ml-auto"> 
			<li class="nav-item">
			<a href="logout.php" class="nav-link">
				<p>Logout</p>
			</a>		</li>	        
    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside id="main-sidebar" style="background-color:#2C394B" class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="#" class="brand-link">
      
      <span class="brand-text" style="font-weight:bold; margin-left:40px; color:#f5deb3">PUDUCHERRY</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Sidebar user (optional) -->
      <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="image">
          <img src="images/avatar5.png" class="img-circle elevation-2" alt="User Image">
        </div> 
  
<!--For Alert Notification Popup Start -->  
<script>
$(function() {
	// 20220201: Commented the following lines. After vapt, we can uncomment 
	//  setInterval(function(){
	//  	Alert_notifications();
    //  }, 10000);
	 
	//  function Alert_notifications()
 	//  {
	//  	//toastr.success('Lorem ipsum dolor sit amet, consetetur sadipscing elitr.');
	// 	xhttp = new XMLHttpRequest();
	// 	xhttp.onreadystatechange = function() {
	// 		if (this.readyState == 4 && this.status == 200) {
	// 			slno_alert = 0;
	// 			alert_js_obj = JSON.parse(this.responseText);
	// 			if(alert_js_obj.length > 0) {
	// 				alert_list = '';
	// 				for(i=0; i < alert_js_obj.length; i++) {
						
	// 					var alert_name = '';
					
	// 					if(alert_js_obj[i]['alert_code'] == 'ALR-SOS')
	// 						alert_name = 'Emergency Alert';
	// 					else if(alert_js_obj[i]['alert_code'] == 'ALR-OVRS')
	// 						alert_name = 'Over Speed';
	// 					else if(alert_js_obj[i]['alert_code'] == 'ALR-RD')
	// 						alert_name = 'Route Deviation';
	// 					else if(alert_js_obj[i]['alert_code'] == 'ALR-STMP')
	// 						alert_name = 'Emergency Wire Cut';
	// 					else if(alert_js_obj[i]['alert_code'] == 'ALR-GEOFENCE-SPEED-V')
	// 						alert_name = 'Geofence Speed Violation';	
							
	// 					var address = '';
						
	// 					if(alert_js_obj[i]['address'] != null)
	// 						address = alert_js_obj[i]['address'];
					
	// 					toastr.error('<h6>'+alert_name+'</h6><p>'+alert_js_obj[i]['vehicle_number']+' , '+alert_js_obj[i]['created_datetime_val']+' , '+address+'</p>');						
						
	// 				}
					
	// 			}
	// 		}
	// 	};
	// 	xhttp.open("GET", "ajax/popup.php?action=get_alerts", true);
	// 	xhttp.send();				
	//  }
});	
</script>
<!--For Alert Notification Popup End -->
<style>
    .page_loader{
        position: fixed;
        z-index: 99999;
        background: rgba(255,255,255,.5);
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
</style>
<style id="onPrint-style">
    table{
        border-collapse: collapse;
        width: 100%;
    }

    td, th {
    border: 1px solid #dddddd;
    text-align: left;
    padding: 8px;
    }




    @media print  {
        input{border: none !important;}
    }

</style>
<div class="page_loader" style="display:none;">
    <div class="d-flex page_loader_content justify-content-center">
        <img src="https://mc.py.gov.in/assets/img/ajax-loader.gif" style="width: 60px; padding-top: 210px;">
    </div>
</div>
<div class="content-wrapper">
	<!-- Content Header (Page header) -->
	<section class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
            <div class="col-sm-6">
                <h1>ESIM Validaty Check</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                <li class="breadcrumb-item"><a href="dashboard_itms.php">Home</a></li>
                <li class="breadcrumb-item active">ESIM Validaty Check</li>
                </ol>
            </div>
            </div>
        </div><!-- /.container-fluid -->
	</section>

    <!-- Main content -->
    <section class="content">
        <div class="card">
	        <div class="card-body">
                <div class="row d-flex justify-content-center">
                    <div class="col-md-6">
                        <div class="alert" role="alert">
                            
                        </div>
                    </div>
                </div>
                <br>
                <div class="row d-flex justify-content-center">
                    <div class="col-md-6">
                        <form id="esimDataForm">
                            <div class="mb-3">
                                <label for="esim_provider" class="form-label">ESIM Provider*</label>
                                <select name="esim_provider" id="esim_provider" class="form-control form-control-sm">
                                    <option value="" selected disabled>Select ESIM Provider</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="imei" class="form-label">IMEI</label>
                                <input type="number" autocomplete="off" required class="form-control form-control-sm" id="imei" name="imei">
                            </div>
                            <button type="submit" value="Search" class="btn btn-primary">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        
        <div class="card">
	        <div class="card-body">
                <div class="row">
                    <div class="col-md-12 d-flex justify-content-end">
                        <a href="javascript:void(0)" id="printBtn" onclick="popup()">
                            <i class="fa fa-print"></i>
                        </a>
                    </div>
                </div>
                <div id="dataCardBodyDiv">
                    <div class="row">
                        <div class="col-12 d-flex justify-content-center">
                            <h2>VAHAN DETAILS</h2>
                        </div>
                    </div>
                    <div class="row d-flex justify-content-center">
                        <div class="col-10" id="vahan_details">

                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 d-flex justify-content-center">
                            <h2>ESIM DETAILS</h2>
                        </div>
                    </div>

                    <table class="table table-sm table-bordered" id="total_details">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Field Name</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

</div>

<script type="text/javascript">
    // var copyData = '{';
    var printData = '';
    $(document).ready(function (){
        
        $('.alert').hide();
        $('#total_details').parent().parent().hide();
        get_esim_list();
        $('#esimDataForm').on('submit', function (e){
            e.preventDefault();
            var formData = new FormData(this);
            formData.append('type', 'send');
            $.ajax({
                url: 'ajax/ajax_check_esim_validaty.php',
                type: "POST",
                data: formData,
                dataType: 'json',
                contentType: false,
                cache: false,
                processData: false,
                beforeSend: function() {
                    $('.page_loader').show();
                },
                success: function(data) {
                    $('.page_loader').hide();
                    $('.alert').show();
                    if(data.status == 'success'){
                        $('.alert').addClass('alert-success');
                        $('.alert').text(data.message);
                    } else{
                        $('.alert').addClass('alert-warning');
                        $('.alert').text(data.message);
                    }
                    $('#total_details').parent().parent().show();
                    var tr = '';
                    var dataFull;
                    if((data.m2m_api.apiResponseCode == 'LCM_001') || (data.m2m_api.apiResponseCode == '001')){
                        if(data.m2m_api.resultObj != undefined){
                            dataFull = data.m2m_api.resultObj[0];
                        } else if(data.m2m_api.sim_entity != undefined) {
                            dataFull = data.m2m_api.sim_entity[0];
                        }
                    } else if(data.m2m_api.code == '200'){
                        dataFull = data.m2m_api.data;
                    } else if(data.m2m_api.apiResponseCode == '200'){
                        dataFull = data.m2m_api;
                    }
                    
                    tr=''; var count = 0;
                    var length = Object.keys(dataFull).length;
                    $.each(dataFull, function (index, value){
                        count++;
                        tr += '<tr>'+
                                '<td>'+count+'</td>'+
                                '<th>'+index+'</th>'+
                                '<td>'+value+'</td>'+
                            '</tr>';
                    });
                    $('#total_details tbody').html(tr);
                    vahanDataDisplay(data.vahan_data, 'vahan_details');
                    printData = '<html><head><style>' + $('#onPrint-style').html() + '</style><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"></head><body>' + $('#dataCardBodyDiv').html() + '</body></html>';
                },
                error: function(errResp) {
                    console.log(errResp);
                }
            });
        });
    });

    function popup() {
        var frame1 = $('<iframe />');
        frame1[0].name = "frame1";
        frame1.css({ "position": "absolute", "top": "-1000000px" });
        $("body").append(frame1);
        var frameDoc = frame1[0].contentWindow ? frame1[0].contentWindow : frame1[0].contentDocument.document ? frame1[0].contentDocument.document : frame1[0].contentDocument;
        frameDoc.document.open();
        //Create a new HTML document.
        frameDoc.document.write(printData);
        frameDoc.document.close();
        setTimeout(function() {
            window.frames["frame1"].focus();
            window.frames["frame1"].print();
            frame1.remove();
        }, 500);
        return true;
    }

    function vahanDataDisplay(vahanData, divID){
        var html = '<table class="table table-bordered" cellspacing="0" cellpadding="0">'+
                    '<tbody>'+
                        '<tr>'+
                            '<th scope="row">Chassis No</th>'+
                            '<td>' + vahanData.chassisNo + '</td>'+
                            '<th scope="row">Date Of Registration</th>'+
                            '<td>' + vahanData.date + '</td>'+
                        '</tr>'+
                        '<tr>'+
                            '<th scope="row">Device Activation Status</th>'+
                            '<td>' + vahanData.deviceActivationStatus + '</td>'+
                            '<th scope="row">Device Serial No</th>'+
                            '<td>' + vahanData.deviceSerialno + '</td>'+
                        '</tr>'+
                        '<tr>'+
                            '<th scope="row">Engine No</th>'+
                            '<td>' + vahanData.engineNo + '</td>'+
                            '<th scope="row">Fitment CentreName</th>'+
                            '<td>' + vahanData.fitmentCentreName + '</td>'+
                        '</tr>'+
                        '<tr>'+
                            '<th scope="row">ICCID</th>'+
                            '<td>' + vahanData.iccId + '</td>'+
                            '<th scope="row">Imei No</th>'+
                            '<td>' + vahanData.imeiNo + '</td>'+
                        '</tr>'+
                        '<tr>'+
                            '<th scope="row">Maker Name</th>'+
                            '<td>' + vahanData.makerName + '</td>'+
                            '<th scope="row">Model Name</th>'+
                            '<td>' + vahanData.modelName + '</td>'+
                        '</tr>'+
                        '<tr>'+
                            '<th scope="row">Owner Name</th>'+
                            '<td>' + vahanData.ownerName + '</td>'+
                            '<th scope="row">Registration No</th>'+
                            '<td>' + vahanData.regnNo + '</td>'+
                        '</tr>'+
                        '<tr>'+
                            '<th scope="row">TAC No</th>'+
                            '<td>' + vahanData.tacNo + '</td>'+
                            '<th scope="row">TAC ValidUpto</th>'+
                            '<td>' + vahanData.tacValidUpto + '</td>'+
                        '</tr>'+
                        '<tr>'+
                            '<th scope="row">Vehicle Class</th>'+
                            '<td>' + vahanData.vehClass + '</td>'+
                        '</tr>'+
                    '</tbody>'+
                '</table>';
        $(document).find('#'+divID).html(html);
    }

    function copyContent(content = ''){
        if(content == ''){
            content = copyData;
        }
        if (navigator.clipboard) {
            navigator.clipboard.writeText(content)
                .then(function () {
                    // Clipboard write succeeded
                    // You can add your success handling code here
                })
                .catch(function (err) {
                    console.error('Unable to write to clipboard: ', err);
                });
        } else {
            console.error('Clipboard API not available in this browser.');
        }
    }

    function get_esim_list(){
        var formData = new FormData();
        formData.append('type', 'esim_list');
        $.ajax({
            url: 'ajax/ajax_check_esim_validaty.php',
            type: "POST",
            data: formData,
            dataType: 'json',
            contentType: false,
            cache: false,
            processData: false,
            beforeSend: function() {
                $('.page_loader').show();
            },
            success: function(data) {
                $('.page_loader').hide();
                var option = '<option value="" selected disabled>Select ESIM Provider</option>';
                if(data.provider_list.length > 0){
                    $.each(data.provider_list, function (index, value){
                        option += '<option value="' + value.id + '">' + value.service_provider_name + '</option>';
                    });
                }
                $("#esim_provider").html(option);
            },
            error: function(errResp) {
                console.log(errResp);
            }
        });
    }
</script> <footer class="main-footer">    
    All rights reserved
  </footer>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->
</body>
</html>
